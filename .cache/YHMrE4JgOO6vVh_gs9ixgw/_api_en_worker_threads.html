<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>worker_threads | Node.js API &#x82F1;&#x6587;&#x6587;&#x6863;</title>
  <link rel="icon" sizes="32x32" type="image/png" href="//static.nodejs.cn/_static/img/favicon.png">
  <script>
    document.write('<link href="' + (location.port ? '' : '//static.nodejs.cn') + '/_static/css/api.css?1540915608037" rel="stylesheet">')
  </script>
</head>
<body class="alt apidoc lang_en" id="page_api_en">
  <div id="api-section-worker_threads">
    <div id="content" class="clearfix">
      <div id="column2" class="interior">
        <div id="intro" class="interior">
          <a href="/">
            Node.js &#x4E2D;&#x6587;&#x7F51;
          </a>
        </div>
        <ul>
<li><a href="_api_en_documentation.html" class="nav-documentation">About these Docs</a></li>
<li><a href="_api_en_synopsis.html" class="nav-synopsis">Usage &amp; Example</a></li>
</ul>
<div class="line"></div>
<ul>
<li><a href="_api_en_assert.html" class="nav-assert">Assertion Testing</a></li>
<li><a href="_api_en_async_hooks.html" class="nav-async_hooks">Async Hooks</a></li>
<li><a href="_api_en_buffer.html" class="nav-buffer">Buffer</a></li>
<li><a href="_api_en_addons.html" class="nav-addons">C++ Addons</a></li>
<li><a href="_api_en_n-api.html" class="nav-n-api">C/C++ Addons - N-API</a></li>
<li><a href="_api_en_child_process.html" class="nav-child_process">Child Processes</a></li>
<li><a href="_api_en_cluster.html" class="nav-cluster">Cluster</a></li>
<li><a href="_api_en_cli.html" class="nav-cli">Command Line Options</a></li>
<li><a href="_api_en_console.html" class="nav-console">Console</a></li>
<li><a href="_api_en_crypto.html" class="nav-crypto">Crypto</a></li>
<li><a href="_api_en_debugger.html" class="nav-debugger">Debugger</a></li>
<li><a href="_api_en_deprecations.html" class="nav-deprecations">Deprecated APIs</a></li>
<li><a href="_api_en_dns.html" class="nav-dns">DNS</a></li>
<li><a href="_api_en_domain.html" class="nav-domain">Domain</a></li>
<li><a href="_api_en_esm.html" class="nav-esm">ECMAScript Modules</a></li>
<li><a href="_api_en_errors.html" class="nav-errors">Errors</a></li>
<li><a href="_api_en_events.html" class="nav-events">Events</a></li>
<li><a href="_api_en_fs.html" class="nav-fs">File System</a></li>
<li><a href="_api_en_globals.html" class="nav-globals">Globals</a></li>
<li><a href="_api_en_http.html" class="nav-http">HTTP</a></li>
<li><a href="_api_en_http2.html" class="nav-http2">HTTP/2</a></li>
<li><a href="_api_en_https.html" class="nav-https">HTTPS</a></li>
<li><a href="_api_en_inspector.html" class="nav-inspector">Inspector</a></li>
<li><a href="_api_en_intl.html" class="nav-intl">Internationalization</a></li>
<li><a href="_api_en_modules.html" class="nav-modules">Modules</a></li>
<li><a href="_api_en_net.html" class="nav-net">Net</a></li>
<li><a href="_api_en_os.html" class="nav-os">OS</a></li>
<li><a href="_api_en_path.html" class="nav-path">Path</a></li>
<li><a href="_api_en_perf_hooks.html" class="nav-perf_hooks">Performance Hooks</a></li>
<li><a href="_api_en_process.html" class="nav-process">Process</a></li>
<li><a href="_api_en_punycode.html" class="nav-punycode">Punycode</a></li>
<li><a href="_api_en_querystring.html" class="nav-querystring">Query Strings</a></li>
<li><a href="_api_en_readline.html" class="nav-readline">Readline</a></li>
<li><a href="_api_en_repl.html" class="nav-repl">REPL</a></li>
<li><a href="_api_en_stream.html" class="nav-stream">Stream</a></li>
<li><a href="_api_en_string_decoder.html" class="nav-string_decoder">String Decoder</a></li>
<li><a href="_api_en_timers.html" class="nav-timers">Timers</a></li>
<li><a href="_api_en_tls.html" class="nav-tls">TLS/SSL</a></li>
<li><a href="_api_en_tracing.html" class="nav-tracing">Trace Events</a></li>
<li><a href="_api_en_tty.html" class="nav-tty">TTY</a></li>
<li><a href="_api_en_dgram.html" class="nav-dgram">UDP/Datagram</a></li>
<li><a href="_api_en_url.html" class="nav-url">URL</a></li>
<li><a href="_api_en_util.html" class="nav-util">Utilities</a></li>
<li><a href="_api_en_v8.html" class="nav-v8">V8</a></li>
<li><a href="_api_en_vm.html" class="nav-vm">VM</a></li>
<li><a href="_api_en_worker_threads.html" class="nav-worker_threads active">Worker Threads</a></li>
<li><a href="_api_en_zlib.html" class="nav-zlib">ZLIB</a></li>
</ul>
<div class="line"></div>
<ul>
<li><a href="https://github.com/nodejs/node" class="nav-https-github-com-nodejs-node">GitHub Repo &amp; Issue Tracker</a></li>
<li><a href="https://groups.google.com/forum/#!forum/nodejs" class="nav-https-groups-google-com-forum-forum-nodejs">Mailing List</a></li>
</ul>
      </div>
  
      <div id="column1" data-id="worker_threads" class="interior">
        <header>
          <h1>Node.js v10.13.0 &#x82F1;&#x6587;&#x6587;&#x6863;</h1>
          <div id="gtoc">
            <p>
              <a href="_api_en_index.html" name="toc">&#x8FD4;&#x56DE;&#x6587;&#x6863;&#x9996;&#x9875;</a> |
              <!--<a href="all.html">View on single page</a> |-->
              <!--<a href="worker_threads.json">View as JSON</a> |-->
              <a href="_api_worker_threads.html">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a>
            </p>
          </div>
          <hr>
        </header>

        <div id="adWrap"></div>
  
        <div id="toc">
          <h2>&#x76EE;&#x5F55;</h2>
          <ul>
<li>
<p><span class="stability_1"><a href="_api_en_worker_threads.html#worker_threads_worker_threads">Worker Threads</a></span></p>
<ul>
<li><a href="_api_en_worker_threads.html#worker_threads_worker_ismainthread">worker.isMainThread</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_worker_parentport">worker.parentPort</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_worker_threadid">worker.threadId</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_worker_workerdata">worker.workerData</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_class_messagechannel">Class: MessageChannel</a></li>
<li>
<p><a href="_api_en_worker_threads.html#worker_threads_class_messageport">Class: MessagePort</a></p>
<ul>
<li><a href="_api_en_worker_threads.html#worker_threads_event_close">Event: &apos;close&apos;</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_event_message">Event: &apos;message&apos;</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_port_close">port.close()</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_port_postmessage_value_transferlist">port.postMessage(value[, transferList])</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_port_ref">port.ref()</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_port_start">port.start()</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_port_unref">port.unref()</a></li>
</ul>
</li>
<li>
<p><a href="_api_en_worker_threads.html#worker_threads_class_worker">Class: Worker</a></p>
<ul>
<li><a href="_api_en_worker_threads.html#worker_threads_new_worker_filename_options">new Worker(filename[, options])</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_event_error">Event: &apos;error&apos;</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_event_exit">Event: &apos;exit&apos;</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_event_message_1">Event: &apos;message&apos;</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_event_online">Event: &apos;online&apos;</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_worker_postmessage_value_transferlist">worker.postMessage(value[, transferList])</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_worker_ref">worker.ref()</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_worker_stderr">worker.stderr</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_worker_stdin">worker.stdin</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_worker_stdout">worker.stdout</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_worker_terminate_callback">worker.terminate([callback])</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_worker_threadid_1">worker.threadId</a></li>
<li><a href="_api_en_worker_threads.html#worker_threads_worker_unref">worker.unref()</a></li>
</ul>
</li>
</ul>
</li>
</ul>
        </div>
  
        <div id="apicontent">
          <h1>Worker Threads<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_worker_threads" id="worker_threads_worker_threads">#</a></span></h1><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_worker_threads" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<!--introduced_in=v10.5.0-->
<p></p><div class="api_stability api_stability_1"><a href="_api_en_documentation.html#documentation_stability_index">Stability: 1</a> - Experimental</div><p></p>
<p>The <code>worker</code> module provides a way to create multiple environments running
on independent threads, and to create message channels between them. It
can be accessed using the <code>--experimental-worker</code> flag and:</p>
<pre><code class="language-js">const worker = require(&apos;worker_threads&apos;);
</code></pre>
<p>Workers are useful for performing CPU-intensive JavaScript operations; do not
use them for I/O, since Node.js&#x2019;s built-in mechanisms for performing operations
asynchronously already treat it more efficiently than Worker threads can.</p>
<p>Workers, unlike child processes or when using the <code>cluster</code> module, can also
share memory efficiently by transferring <code>ArrayBuffer</code> instances or sharing
<code>SharedArrayBuffer</code> instances between them.</p>
<pre><code class="language-js">const {
  Worker, isMainThread, parentPort, workerData
} = require(&apos;worker_threads&apos;);

if (isMainThread) {
  module.exports = async function parseJSAsync(script) {
    return new Promise((resolve, reject) =&gt; {
      const worker = new Worker(__filename, {
        workerData: script
      });
      worker.on(&apos;message&apos;, resolve);
      worker.on(&apos;error&apos;, reject);
      worker.on(&apos;exit&apos;, (code) =&gt; {
        if (code !== 0)
          reject(new Error(`Worker stopped with exit code ${code}`));
      });
    });
  };
} else {
  const { parse } = require(&apos;some-js-parsing-library&apos;);
  const script = workerData;
  parentPort.postMessage(parse(script));
}
</code></pre>
<p>Note that this example spawns a Worker thread for each <code>parse</code> call.
In practice, it is strongly recommended to use a pool of Workers for these
kinds of tasks, since the overhead of creating Workers would likely exceed the
benefit of handing the work off to it.</p>
<h2>worker.isMainThread<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_worker_ismainthread" id="worker_threads_worker_ismainthread">#</a></span></h2><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_worker_ismainthread" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li><a href="/s/_moz/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a></li>
</ul>
<p>Is <code>true</code> if this code is not running inside of a <a href="_api_en_worker_threads.html#worker_threads_class_worker"><code>Worker</code></a> thread.</p>
<h2>worker.parentPort<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_worker_parentport" id="worker_threads_worker_parentport">#</a></span></h2><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_worker_parentport" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li><a href="/s/_moz/Data_structures#Null_type" class="type">&lt;null&gt;</a> | <a href="_api_en_worker_threads.html#worker_threads_class_messageport" class="type">&lt;MessagePort&gt;</a></li>
</ul>
<p>If this thread was spawned as a <a href="_api_en_worker_threads.html#worker_threads_class_worker"><code>Worker</code></a>, this will be a <a href="_api_en_worker_threads.html#worker_threads_class_messageport"><code>MessagePort</code></a>
allowing communication with the parent thread. Messages sent using
<code>parentPort.postMessage()</code> will be available in the parent thread
using <code>worker.on(&apos;message&apos;)</code>, and messages sent from the parent thread
using <code>worker.postMessage()</code> will be available in this thread using
<code>parentPort.on(&apos;message&apos;)</code>.</p>
<h2>worker.threadId<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_worker_threadid" id="worker_threads_worker_threadid">#</a></span></h2><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_worker_threadid" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li><a href="/s/_moz/Data_structures#Number_type" class="type">&lt;integer&gt;</a></li>
</ul>
<p>An integer identifier for the current thread. On the corresponding worker object
(if there is any), it is available as <a href="_api_en_worker_threads.html#worker_threads_worker_threadid_1"><code>worker.threadId</code></a>.</p>
<h2>worker.workerData<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_worker_workerdata" id="worker_threads_worker_workerdata">#</a></span></h2><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_worker_workerdata" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<p>An arbitrary JavaScript value that contains a clone of the data passed
to this thread&#x2019;s <code>Worker</code> constructor.</p>
<h2>Class: MessageChannel<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_class_messagechannel" id="worker_threads_class_messagechannel">#</a></span></h2><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_class_messagechannel" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<p>Instances of the <code>worker.MessageChannel</code> class represent an asynchronous,
two-way communications channel.
The <code>MessageChannel</code> has no methods of its own. <code>new MessageChannel()</code>
yields an object with <code>port1</code> and <code>port2</code> properties, which refer to linked
<a href="_api_en_worker_threads.html#worker_threads_class_messageport"><code>MessagePort</code></a> instances.</p>
<pre><code class="language-js">const { MessageChannel } = require(&apos;worker_threads&apos;);

const { port1, port2 } = new MessageChannel();
port1.on(&apos;message&apos;, (message) =&gt; console.log(&apos;received&apos;, message));
port2.postMessage({ foo: &apos;bar&apos; });
// prints: received { foo: &apos;bar&apos; } from the `port1.on(&apos;message&apos;)` listener
</code></pre>
<h2>Class: MessagePort<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_class_messageport" id="worker_threads_class_messageport">#</a></span></h2><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_class_messageport" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li>Extends: <a href="_api_en_events.html#events_class_eventemitter" class="type">&lt;EventEmitter&gt;</a></li>
</ul>
<p>Instances of the <code>worker.MessagePort</code> class represent one end of an
asynchronous, two-way communications channel. It can be used to transfer
structured data, memory regions and other <code>MessagePort</code>s between different
<a href="_api_en_worker_threads.html#worker_threads_class_worker"><code>Worker</code></a>s.</p>
<p>With the exception of <code>MessagePort</code>s being <a href="_api_en_events.html"><code>EventEmitter</code></a>s rather
than <code>EventTarget</code>s, this implementation matches <a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort">browser <code>MessagePort</code></a>s.</p>
<h3>Event: &apos;close&apos;<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_event_close" id="worker_threads_event_close">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_event_close" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<p>The <code>&apos;close&apos;</code> event is emitted once either side of the channel has been
disconnected.</p>
<h3>Event: &apos;message&apos;<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_event_message" id="worker_threads_event_message">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_event_message" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li><code>value</code> <a href="/s/_moz/Data_structures#Data_types" class="type">&lt;any&gt;</a> The transmitted value</li>
</ul>
<p>The <code>&apos;message&apos;</code> event is emitted for any incoming message, containing the cloned
input of <a href="_api_en_worker_threads.html#worker_threads_port_postmessage_value_transferlist"><code>port.postMessage()</code></a>.</p>
<p>Listeners on this event will receive a clone of the <code>value</code> parameter as passed
to <code>postMessage()</code> and no further arguments.</p>
<h3>port.close()<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_port_close" id="worker_threads_port_close">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_port_close" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<p>Disables further sending of messages on either side of the connection.
This method can be called once you know that no further communication
will happen over this <code>MessagePort</code>.</p>
<h3>port.postMessage(value[, transferList])<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_port_postmessage_value_transferlist" id="worker_threads_port_postmessage_value_transferlist">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_port_postmessage_value_transferlist" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li><code>value</code> <a href="/s/_moz/Data_structures#Data_types" class="type">&lt;any&gt;</a></li>
<li><code>transferList</code> <a href="/s/_moz/Reference/Global_Objects/Object" class="type">&lt;Object[]&gt;</a></li>
</ul>
<p>Sends a JavaScript value to the receiving side of this channel.
<code>value</code> will be transferred in a way which is compatible with
the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm">HTML structured clone algorithm</a>. In particular, it may contain circular
references and objects like typed arrays that the <code>JSON</code> API is not able
to stringify.</p>
<p><code>transferList</code> may be a list of <code>ArrayBuffer</code> and <code>MessagePort</code> objects.
After transferring, they will not be usable on the sending side of the channel
anymore (even if they are not contained in <code>value</code>). Unlike with
<a href="_api_en_child_process.html">child processes</a>, transferring handles such as network sockets is currently
not supported.</p>
<p>If <code>value</code> contains <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer"><code>SharedArrayBuffer</code></a> instances, those will be accessible
from either thread. They cannot be listed in <code>transferList</code>.</p>
<p><code>value</code> may still contain <code>ArrayBuffer</code> instances that are not in
<code>transferList</code>; in that case, the underlying memory is copied rather than moved.</p>
<p>Because the object cloning uses the structured clone algorithm,
non-enumerable properties, property accessors, and object prototypes are
not preserved. In particular, <a href="_api_en_buffer.html"><code>Buffer</code></a> objects will be read as
plain <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array"><code>Uint8Array</code></a>s on the receiving side.</p>
<p>The message object will be cloned immediately, and can be modified after
posting without having side effects.</p>
<p>For more information on the serialization and deserialization mechanisms
behind this API, see the <a href="_api_en_v8.html#v8_serialization_api">serialization API of the <code>v8</code> module</a>.</p>
<h3>port.ref()<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_port_ref" id="worker_threads_port_ref">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_port_ref" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<p>Opposite of <code>unref()</code>. Calling <code>ref()</code> on a previously <code>unref()</code>ed port will
<em>not</em> let the program exit if it&apos;s the only active handle left (the default
behavior). If the port is <code>ref()</code>ed, calling <code>ref()</code> again will have no effect.</p>
<p>If listeners are attached or removed using <code>.on(&apos;message&apos;)</code>, the port will
be <code>ref()</code>ed and <code>unref()</code>ed automatically depending on whether
listeners for the event exist.</p>
<h3>port.start()<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_port_start" id="worker_threads_port_start">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_port_start" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<p>Starts receiving messages on this <code>MessagePort</code>. When using this port
as an event emitter, this will be called automatically once <code>&apos;message&apos;</code>
listeners are attached.</p>
<h3>port.unref()<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_port_unref" id="worker_threads_port_unref">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_port_unref" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<p>Calling <code>unref()</code> on a port will allow the thread to exit if this is the only
active handle in the event system. If the port is already <code>unref()</code>ed calling
<code>unref()</code> again will have no effect.</p>
<p>If listeners are attached or removed using <code>.on(&apos;message&apos;)</code>, the port will
be <code>ref()</code>ed and <code>unref()</code>ed automatically depending on whether
listeners for the event exist.</p>
<h2>Class: Worker<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_class_worker" id="worker_threads_class_worker">#</a></span></h2><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_class_worker" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<p>The <code>Worker</code> class represents an independent JavaScript execution thread.
Most Node.js APIs are available inside of it.</p>
<p>Notable differences inside a Worker environment are:</p>
<ul>
<li>The <a href="_api_en_process.html#process_process_stdin"><code>process.stdin</code></a>, <a href="_api_en_process.html#process_process_stdout"><code>process.stdout</code></a> and <a href="_api_en_process.html#process_process_stderr"><code>process.stderr</code></a>
may be redirected by the parent thread.</li>
<li>The <a href="_api_en_worker_threads.html#worker_threads_worker_ismainthread"><code>require(&apos;worker_threads&apos;).isMainThread</code></a> property is set to <code>false</code>.</li>
<li>The <a href="_api_en_worker_threads.html#worker_threads_worker_parentport"><code>require(&apos;worker_threads&apos;).parentPort</code></a> message port is available,</li>
<li><a href="_api_en_process.html#process_process_exit_code"><code>process.exit()</code></a> does not stop the whole program, just the single thread,
and <a href="_api_en_process.html#process_process_abort"><code>process.abort()</code></a> is not available.</li>
<li><a href="_api_en_process.html#process_process_chdir_directory"><code>process.chdir()</code></a> and <code>process</code> methods that set group or user ids
are not available.</li>
<li><a href="_api_en_process.html#process_process_env"><code>process.env</code></a> is a read-only reference to the environment variables.</li>
<li><a href="_api_en_process.html#process_process_title"><code>process.title</code></a> cannot be modified.</li>
<li>Signals will not be delivered through <a href="_api_en_process.html#process_signal_events"><code>process.on(&apos;...&apos;)</code></a>.</li>
<li>Execution may stop at any point as a result of <a href="_api_en_worker_threads.html#worker_threads_worker_terminate_callback"><code>worker.terminate()</code></a>
being invoked.</li>
<li>IPC channels from parent processes are not accessible.</li>
</ul>
<p>Currently, the following differences also exist until they are addressed:</p>
<ul>
<li>The <a href="_api_en_inspector.html"><code>inspector</code></a> module is not available yet.</li>
<li>Native addons are not supported yet.</li>
</ul>
<p>Creating <code>Worker</code> instances inside of other <code>Worker</code>s is possible.</p>
<p>Like <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API">Web Workers</a> and the <a href="_api_en_cluster.html"><code>cluster</code> module</a>, two-way communication can be
achieved through inter-thread message passing. Internally, a <code>Worker</code> has a
built-in pair of <a href="_api_en_worker_threads.html#worker_threads_class_messageport"><code>MessagePort</code></a>s that are already associated with each other
when the <code>Worker</code> is created. While the <code>MessagePort</code> object on the parent side
is not directly exposed, its functionalities are exposed through
<a href="_api_en_worker_threads.html#worker_threads_worker_postmessage_value_transferlist"><code>worker.postMessage()</code></a> and the <a href="_api_en_worker_threads.html#worker_threads_event_message_1"><code>worker.on(&apos;message&apos;)</code></a> event
on the <code>Worker</code> object for the parent thread.</p>
<p>To create custom messaging channels (which is encouraged over using the default
global channel because it facilitates separation of concerns), users can create
a <code>MessageChannel</code> object on either thread and pass one of the
<code>MessagePort</code>s on that <code>MessageChannel</code> to the other thread through a
pre-existing channel, such as the global one.</p>
<p>See <a href="_api_en_worker_threads.html#worker_threads_port_postmessage_value_transferlist"><code>port.postMessage()</code></a> for more information on how messages are passed,
and what kind of JavaScript values can be successfully transported through
the thread barrier.</p>
<pre><code class="language-js">const assert = require(&apos;assert&apos;);
const {
  Worker, MessageChannel, MessagePort, isMainThread, parentPort
} = require(&apos;worker_threads&apos;);
if (isMainThread) {
  const worker = new Worker(__filename);
  const subChannel = new MessageChannel();
  worker.postMessage({ hereIsYourPort: subChannel.port1 }, [subChannel.port1]);
  subChannel.port2.on(&apos;message&apos;, (value) =&gt; {
    console.log(&apos;received:&apos;, value);
  });
} else {
  parentPort.once(&apos;message&apos;, (value) =&gt; {
    assert(value.hereIsYourPort instanceof MessagePort);
    value.hereIsYourPort.postMessage(&apos;the worker is sending this&apos;);
    value.hereIsYourPort.close();
  });
}
</code></pre>
<h3>new Worker(filename[, options])<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_new_worker_filename_options" id="worker_threads_new_worker_filename_options">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_new_worker_filename_options" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<ul>
<li><code>filename</code> <a href="/s/_moz/Data_structures#String_type" class="type">&lt;string&gt;</a> The path to the Worker&#x2019;s main script. Must be
either an absolute path or a relative path (i.e. relative to the
current working directory) starting with <code>./</code> or <code>../</code>.
If <code>options.eval</code> is true, this is a string containing JavaScript code rather
than a path.</li>
<li>
<p><code>options</code> <a href="/s/_moz/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a></p>
<ul>
<li><code>eval</code> <a href="/s/_moz/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If true, interpret the first argument to the constructor
as a script that is executed once the worker is online.</li>
<li><code>workerData</code> <a href="/s/_moz/Data_structures#Data_types" class="type">&lt;any&gt;</a> Any JavaScript value that will be cloned and made
available as <a href="_api_en_worker_threads.html#worker_threads_worker_workerdata"><code>require(&apos;worker_threads&apos;).workerData</code></a>. The cloning will
occur as described in the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm">HTML structured clone algorithm</a>, and an error
will be thrown if the object cannot be cloned (e.g. because it contains
<code>function</code>s).</li>
<li>stdin <a href="/s/_moz/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If this is set to <code>true</code>, then <code>worker.stdin</code> will
provide a writable stream whose contents will appear as <code>process.stdin</code>
inside the Worker. By default, no data is provided.</li>
<li>stdout <a href="/s/_moz/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If this is set to <code>true</code>, then <code>worker.stdout</code> will
not automatically be piped through to <code>process.stdout</code> in the parent.</li>
<li>stderr <a href="/s/_moz/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If this is set to <code>true</code>, then <code>worker.stderr</code> will
not automatically be piped through to <code>process.stderr</code> in the parent.</li>
</ul>
</li>
</ul>
<h3>Event: &apos;error&apos;<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_event_error" id="worker_threads_event_error">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_event_error" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li><code>err</code> <a href="/s/_moz/Reference/Global_Objects/Error" class="type">&lt;Error&gt;</a></li>
</ul>
<p>The <code>&apos;error&apos;</code> event is emitted if the worker thread throws an uncaught
exception. In that case, the worker will be terminated.</p>
<h3>Event: &apos;exit&apos;<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_event_exit" id="worker_threads_event_exit">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_event_exit" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li><code>exitCode</code> <a href="/s/_moz/Data_structures#Number_type" class="type">&lt;integer&gt;</a></li>
</ul>
<p>The <code>&apos;exit&apos;</code> event is emitted once the worker has stopped. If the worker
exited by calling <a href="_api_en_process.html#process_process_exit_code"><code>process.exit()</code></a>, the <code>exitCode</code> parameter will be the
passed exit code. If the worker was terminated, the <code>exitCode</code> parameter will
be <code>1</code>.</p>
<h3>Event: &apos;message&apos;<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_event_message_1" id="worker_threads_event_message_1">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_event_message_1" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li><code>value</code> <a href="/s/_moz/Data_structures#Data_types" class="type">&lt;any&gt;</a> The transmitted value</li>
</ul>
<p>The <code>&apos;message&apos;</code> event is emitted when the worker thread has invoked
<a href="_api_en_worker_threads.html#worker_threads_worker_postmessage_value_transferlist"><code>require(&apos;worker_threads&apos;).postMessage()</code></a>. See the <a href="_api_en_worker_threads.html#worker_threads_event_message"><code>port.on(&apos;message&apos;)</code></a>
event for more details.</p>
<h3>Event: &apos;online&apos;<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_event_online" id="worker_threads_event_online">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_event_online" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<p>The <code>&apos;online&apos;</code> event is emitted when the worker thread has started executing
JavaScript code.</p>
<h3>worker.postMessage(value[, transferList])<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_worker_postmessage_value_transferlist" id="worker_threads_worker_postmessage_value_transferlist">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_worker_postmessage_value_transferlist" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li><code>value</code> <a href="/s/_moz/Data_structures#Data_types" class="type">&lt;any&gt;</a></li>
<li><code>transferList</code> <a href="/s/_moz/Reference/Global_Objects/Object" class="type">&lt;Object[]&gt;</a></li>
</ul>
<p>Send a message to the worker that will be received via
<a href="_api_en_worker_threads.html#worker_threads_event_message"><code>require(&apos;worker_threads&apos;).parentPort.on(&apos;message&apos;)</code></a>.
See <a href="_api_en_worker_threads.html#worker_threads_port_postmessage_value_transferlist"><code>port.postMessage()</code></a> for more details.</p>
<h3>worker.ref()<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_worker_ref" id="worker_threads_worker_ref">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_worker_ref" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<p>Opposite of <code>unref()</code>, calling <code>ref()</code> on a previously <code>unref()</code>ed worker will
<em>not</em> let the program exit if it&apos;s the only active handle left (the default
behavior). If the worker is <code>ref()</code>ed, calling <code>ref()</code> again will have
no effect.</p>
<h3>worker.stderr<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_worker_stderr" id="worker_threads_worker_stderr">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_worker_stderr" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li><a href="_api_en_stream.html#stream_class_stream_readable" class="type">&lt;stream.Readable&gt;</a></li>
</ul>
<p>This is a readable stream which contains data written to <a href="_api_en_process.html#process_process_stderr"><code>process.stderr</code></a>
inside the worker thread. If <code>stderr: true</code> was not passed to the
<a href="_api_en_worker_threads.html#worker_threads_class_worker"><code>Worker</code></a> constructor, then data will be piped to the parent thread&apos;s
<a href="_api_en_process.html#process_process_stderr"><code>process.stderr</code></a> stream.</p>
<h3>worker.stdin<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_worker_stdin" id="worker_threads_worker_stdin">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_worker_stdin" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li><a href="/s/_moz/Data_structures#Null_type" class="type">&lt;null&gt;</a> | <a href="_api_en_stream.html#stream_class_stream_writable" class="type">&lt;stream.Writable&gt;</a></li>
</ul>
<p>If <code>stdin: true</code> was passed to the <a href="_api_en_worker_threads.html#worker_threads_class_worker"><code>Worker</code></a> constructor, this is a
writable stream. The data written to this stream will be made available in
the worker thread as <a href="_api_en_process.html#process_process_stdin"><code>process.stdin</code></a>.</p>
<h3>worker.stdout<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_worker_stdout" id="worker_threads_worker_stdout">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_worker_stdout" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li><a href="_api_en_stream.html#stream_class_stream_readable" class="type">&lt;stream.Readable&gt;</a></li>
</ul>
<p>This is a readable stream which contains data written to <a href="_api_en_process.html#process_process_stdout"><code>process.stdout</code></a>
inside the worker thread. If <code>stdout: true</code> was not passed to the
<a href="_api_en_worker_threads.html#worker_threads_class_worker"><code>Worker</code></a> constructor, then data will be piped to the parent thread&apos;s
<a href="_api_en_process.html#process_process_stdout"><code>process.stdout</code></a> stream.</p>
<h3>worker.terminate([callback])<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_worker_terminate_callback" id="worker_threads_worker_terminate_callback">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_worker_terminate_callback" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li>
<p><code>callback</code> <a href="/s/_moz/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a></p>
<ul>
<li><code>err</code> <a href="/s/_moz/Reference/Global_Objects/Error" class="type">&lt;Error&gt;</a></li>
<li><code>exitCode</code> <a href="/s/_moz/Data_structures#Number_type" class="type">&lt;integer&gt;</a></li>
</ul>
</li>
</ul>
<p>Stop all JavaScript execution in the worker thread as soon as possible.
<code>callback</code> is an optional function that is invoked once this operation is known
to have completed.</p>
<p><strong>Warning</strong>: Currently, not all code in the internals of Node.js is prepared to
expect termination at arbitrary points in time and may crash if it encounters
that condition. Consequently, you should currently only call <code>.terminate()</code> if
it is known that the Worker thread is not accessing Node.js core modules other
than what is exposed in the <code>worker</code> module.</p>
<h3>worker.threadId<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_worker_threadid_1" id="worker_threads_worker_threadid_1">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_worker_threadid_1" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<ul>
<li><a href="/s/_moz/Data_structures#Number_type" class="type">&lt;integer&gt;</a></li>
</ul>
<p>An integer identifier for the referenced thread. Inside the worker thread,
it is available as <a href="_api_en_worker_threads.html#worker_threads_worker_threadid"><code>require(&apos;worker_threads&apos;).threadId</code></a>.</p>
<h3>worker.unref()<span><a class="mark" href="_api_en_worker_threads.html#worker_threads_worker_unref" id="worker_threads_worker_unref">#</a></span></h3><p class="link_cn_wrap"><a href="_api_worker_threads.html#worker_threads_worker_unref" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<div class="api_metadata">
<span>Added in: v10.5.0</span>
</div>
<p>Calling <code>unref()</code> on a worker will allow the thread to exit if this is the only
active handle in the event system. If the worker is already <code>unref()</code>ed calling
<code>unref()</code> again will have no effect.</p>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.write('<script src="api.js?1540915608037"><\/script>');
  </script>

<script src="../lib/backtop.js"></script></body></html>