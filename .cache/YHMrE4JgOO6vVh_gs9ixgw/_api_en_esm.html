<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>ECMAScript &#x6A21;&#x5757; | Node.js API &#x82F1;&#x6587;&#x6587;&#x6863;</title>
  <link rel="icon" sizes="32x32" type="image/png" href="//static.nodejs.cn/_static/img/favicon.png">
  <script>
    document.write('<link href="' + (location.port ? '' : '//static.nodejs.cn') + '/_static/css/api.css?1540915592519" rel="stylesheet">')
  </script>
</head>
<body class="alt apidoc lang_en" id="page_api_en">
  <div id="api-section-esm">
    <div id="content" class="clearfix">
      <div id="column2" class="interior">
        <div id="intro" class="interior">
          <a href="/">
            Node.js &#x4E2D;&#x6587;&#x7F51;
          </a>
        </div>
        <ul>
<li><a href="_api_en_documentation.html" class="nav-documentation">About these Docs</a></li>
<li><a href="_api_en_synopsis.html" class="nav-synopsis">Usage &amp; Example</a></li>
</ul>
<div class="line"></div>
<ul>
<li><a href="_api_en_assert.html" class="nav-assert">Assertion Testing</a></li>
<li><a href="_api_en_async_hooks.html" class="nav-async_hooks">Async Hooks</a></li>
<li><a href="_api_en_buffer.html" class="nav-buffer">Buffer</a></li>
<li><a href="_api_en_addons.html" class="nav-addons">C++ Addons</a></li>
<li><a href="_api_en_n-api.html" class="nav-n-api">C/C++ Addons - N-API</a></li>
<li><a href="_api_en_child_process.html" class="nav-child_process">Child Processes</a></li>
<li><a href="_api_en_cluster.html" class="nav-cluster">Cluster</a></li>
<li><a href="_api_en_cli.html" class="nav-cli">Command Line Options</a></li>
<li><a href="_api_en_console.html" class="nav-console">Console</a></li>
<li><a href="_api_en_crypto.html" class="nav-crypto">Crypto</a></li>
<li><a href="_api_en_debugger.html" class="nav-debugger">Debugger</a></li>
<li><a href="_api_en_deprecations.html" class="nav-deprecations">Deprecated APIs</a></li>
<li><a href="_api_en_dns.html" class="nav-dns">DNS</a></li>
<li><a href="_api_en_domain.html" class="nav-domain">Domain</a></li>
<li><a href="_api_en_esm.html" class="nav-esm active">ECMAScript Modules</a></li>
<li><a href="_api_en_errors.html" class="nav-errors">Errors</a></li>
<li><a href="_api_en_events.html" class="nav-events">Events</a></li>
<li><a href="_api_en_fs.html" class="nav-fs">File System</a></li>
<li><a href="_api_en_globals.html" class="nav-globals">Globals</a></li>
<li><a href="_api_en_http.html" class="nav-http">HTTP</a></li>
<li><a href="_api_en_http2.html" class="nav-http2">HTTP/2</a></li>
<li><a href="_api_en_https.html" class="nav-https">HTTPS</a></li>
<li><a href="_api_en_inspector.html" class="nav-inspector">Inspector</a></li>
<li><a href="_api_en_intl.html" class="nav-intl">Internationalization</a></li>
<li><a href="_api_en_modules.html" class="nav-modules">Modules</a></li>
<li><a href="_api_en_net.html" class="nav-net">Net</a></li>
<li><a href="_api_en_os.html" class="nav-os">OS</a></li>
<li><a href="_api_en_path.html" class="nav-path">Path</a></li>
<li><a href="_api_en_perf_hooks.html" class="nav-perf_hooks">Performance Hooks</a></li>
<li><a href="_api_en_process.html" class="nav-process">Process</a></li>
<li><a href="_api_en_punycode.html" class="nav-punycode">Punycode</a></li>
<li><a href="_api_en_querystring.html" class="nav-querystring">Query Strings</a></li>
<li><a href="_api_en_readline.html" class="nav-readline">Readline</a></li>
<li><a href="_api_en_repl.html" class="nav-repl">REPL</a></li>
<li><a href="_api_en_stream.html" class="nav-stream">Stream</a></li>
<li><a href="_api_en_string_decoder.html" class="nav-string_decoder">String Decoder</a></li>
<li><a href="_api_en_timers.html" class="nav-timers">Timers</a></li>
<li><a href="_api_en_tls.html" class="nav-tls">TLS/SSL</a></li>
<li><a href="_api_en_tracing.html" class="nav-tracing">Trace Events</a></li>
<li><a href="_api_en_tty.html" class="nav-tty">TTY</a></li>
<li><a href="_api_en_dgram.html" class="nav-dgram">UDP/Datagram</a></li>
<li><a href="_api_en_url.html" class="nav-url">URL</a></li>
<li><a href="_api_en_util.html" class="nav-util">Utilities</a></li>
<li><a href="_api_en_v8.html" class="nav-v8">V8</a></li>
<li><a href="_api_en_vm.html" class="nav-vm">VM</a></li>
<li><a href="_api_en_worker_threads.html" class="nav-worker_threads">Worker Threads</a></li>
<li><a href="_api_en_zlib.html" class="nav-zlib">ZLIB</a></li>
</ul>
<div class="line"></div>
<ul>
<li><a href="https://github.com/nodejs/node" class="nav-https-github-com-nodejs-node">GitHub Repo &amp; Issue Tracker</a></li>
<li><a href="https://groups.google.com/forum/#!forum/nodejs" class="nav-https-groups-google-com-forum-forum-nodejs">Mailing List</a></li>
</ul>
      </div>
  
      <div id="column1" data-id="esm" class="interior">
        <header>
          <h1>Node.js v10.13.0 &#x82F1;&#x6587;&#x6587;&#x6863;</h1>
          <div id="gtoc">
            <p>
              <a href="_api_en_index.html" name="toc">&#x8FD4;&#x56DE;&#x6587;&#x6863;&#x9996;&#x9875;</a> |
              <!--<a href="all.html">View on single page</a> |-->
              <!--<a href="esm.json">View as JSON</a> |-->
              <a href="_api_esm.html">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a>
            </p>
          </div>
          <hr>
        </header>

        <div id="adWrap"></div>
  
        <div id="toc">
          <h2>&#x76EE;&#x5F55;</h2>
          <ul>
<li>
<p><span class="stability_1"><a href="_api_en_esm.html#esm_ecmascript_modules">ECMAScript Modules</a></span></p>
<ul>
<li><a href="_api_en_esm.html#esm_enabling">Enabling</a></li>
<li>
<p><a href="_api_en_esm.html#esm_features">Features</a></p>
<ul>
<li>
<p><a href="_api_en_esm.html#esm_supported">Supported</a></p>
<ul>
<li><a href="_api_en_esm.html#esm_import_meta">import.meta</a></li>
</ul>
</li>
<li><a href="_api_en_esm.html#esm_unsupported">Unsupported</a></li>
</ul>
</li>
<li>
<p><a href="_api_en_esm.html#esm_notable_differences_between_import_and_require">Notable differences between <code>import</code> and <code>require</code></a></p>
<ul>
<li><a href="_api_en_esm.html#esm_no_node_path">No NODE_PATH</a></li>
<li><a href="_api_en_esm.html#esm_no_require_extensions">No <code>require.extensions</code></a></li>
<li><a href="_api_en_esm.html#esm_no_require_cache">No <code>require.cache</code></a></li>
<li><a href="_api_en_esm.html#esm_url_based_paths">URL based paths</a></li>
</ul>
</li>
<li><a href="_api_en_esm.html#esm_interop_with_existing_modules">Interop with existing modules</a></li>
<li>
<p><a href="_api_en_esm.html#esm_loader_hooks">Loader hooks</a></p>
<ul>
<li><a href="_api_en_esm.html#esm_resolve_hook">Resolve hook</a></li>
<li><a href="_api_en_esm.html#esm_dynamic_instantiate_hook">Dynamic instantiate hook</a></li>
</ul>
</li>
</ul>
</li>
</ul>
        </div>
  
        <div id="apicontent">
          <h1>ECMAScript Modules<span><a class="mark" href="_api_en_esm.html#esm_ecmascript_modules" id="esm_ecmascript_modules">#</a></span></h1><p class="link_cn_wrap"><a href="_api_esm.html#esm_ecmascript_modules" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<!--introduced_in=v8.5.0-->
<!-- type=misc -->
<p></p><div class="api_stability api_stability_1"><a href="_api_en_documentation.html#documentation_stability_index">Stability: 1</a> - Experimental</div><p></p>
<!--name=esm-->
<p>Node.js contains support for ES Modules based upon the
<a href="https://github.com/nodejs/node-eps/blob/master/002-es-modules.md">Node.js EP for ES Modules</a>.</p>
<p>Not all features of the EP are complete and will be landing as both VM support
and implementation is ready. Error messages are still being polished.</p>
<h2>Enabling<span><a class="mark" href="_api_en_esm.html#esm_enabling" id="esm_enabling">#</a></span></h2><p class="link_cn_wrap"><a href="_api_esm.html#esm_enabling" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<!-- type=misc -->
<p>The <code>--experimental-modules</code> flag can be used to enable features for loading
ESM modules.</p>
<p>Once this has been set, files ending with <code>.mjs</code> will be able to be loaded
as ES Modules.</p>
<pre><code class="language-sh">node --experimental-modules my-app.mjs
</code></pre>
<h2>Features<span><a class="mark" href="_api_en_esm.html#esm_features" id="esm_features">#</a></span></h2>
<!-- type=misc -->
<h3>Supported<span><a class="mark" href="_api_en_esm.html#esm_supported" id="esm_supported">#</a></span></h3><p class="link_cn_wrap"><a href="_api_esm.html#esm_supported" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<p>Only the CLI argument for the main entry point to the program can be an entry
point into an ESM graph. Dynamic import can also be used to create entry points
into ESM graphs at runtime.</p>
<h4>import.meta<span><a class="mark" href="_api_en_esm.html#esm_import_meta" id="esm_import_meta">#</a></span></h4><p class="link_cn_wrap"><a href="_api_esm.html#esm_import_meta" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<ul>
<li><a href="/s/_moz/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a></li>
</ul>
<p>The <code>import.meta</code> metaproperty is an <code>Object</code> that contains the following
property:</p>
<ul>
<li><code>url</code> <a href="/s/_moz/Data_structures#String_type" class="type">&lt;string&gt;</a> The absolute <code>file:</code> URL of the module.</li>
</ul>
<h3>Unsupported<span><a class="mark" href="_api_en_esm.html#esm_unsupported" id="esm_unsupported">#</a></span></h3><p class="link_cn_wrap"><a href="_api_esm.html#esm_unsupported" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>













<table><thead><tr><th>Feature</th><th>Reason</th></tr></thead><tbody><tr><td><code>require(&apos;./foo.mjs&apos;)</code></td><td>ES Modules have differing resolution and timing, use dynamic import</td></tr></tbody></table>
<h2>Notable differences between `import` and `require`<span><a class="mark" href="_api_en_esm.html#esm_notable_differences_between_import_and_require" id="esm_notable_differences_between_import_and_require">#</a></span></h2>
<h3>No NODE_PATH<span><a class="mark" href="_api_en_esm.html#esm_no_node_path" id="esm_no_node_path">#</a></span></h3><p class="link_cn_wrap"><a href="_api_esm.html#esm_no_node_path" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<p><code>NODE_PATH</code> is not part of resolving <code>import</code> specifiers. Please use symlinks
if this behavior is desired.</p>
<h3>No `require.extensions`<span><a class="mark" href="_api_en_esm.html#esm_no_require_extensions" id="esm_no_require_extensions">#</a></span></h3><p class="link_cn_wrap"><a href="_api_esm.html#esm_no_require_extensions" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<p><code>require.extensions</code> is not used by <code>import</code>. The expectation is that loader
hooks can provide this workflow in the future.</p>
<h3>No `require.cache`<span><a class="mark" href="_api_en_esm.html#esm_no_require_cache" id="esm_no_require_cache">#</a></span></h3><p class="link_cn_wrap"><a href="_api_esm.html#esm_no_require_cache" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<p><code>require.cache</code> is not used by <code>import</code>. It has a separate cache.</p>
<h3>URL based paths<span><a class="mark" href="_api_en_esm.html#esm_url_based_paths" id="esm_url_based_paths">#</a></span></h3><p class="link_cn_wrap"><a href="_api_esm.html#esm_url_based_paths" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<p>ESM are resolved and cached based upon <a href="https://url.spec.whatwg.org/">URL</a>
semantics. This means that files containing special characters such as <code>#</code> and
<code>?</code> need to be escaped.</p>
<p>Modules will be loaded multiple times if the <code>import</code> specifier used to resolve
them have a different query or fragment.</p>
<pre><code class="language-js">import &apos;./foo?query=1&apos;; // loads ./foo with query of &quot;?query=1&quot;
import &apos;./foo?query=2&apos;; // loads ./foo with query of &quot;?query=2&quot;
</code></pre>
<p>For now, only modules using the <code>file:</code> protocol can be loaded.</p>
<h2>Interop with existing modules<span><a class="mark" href="_api_en_esm.html#esm_interop_with_existing_modules" id="esm_interop_with_existing_modules">#</a></span></h2><p class="link_cn_wrap"><a href="_api_esm.html#esm_interop_with_existing_modules" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<p>All CommonJS, JSON, and C++ modules can be used with <code>import</code>.</p>
<p>Modules loaded this way will only be loaded once, even if their query
or fragment string differs between <code>import</code> statements.</p>
<p>When loaded via <code>import</code> these modules will provide a single <code>default</code> export
representing the value of <code>module.exports</code> at the time they finished evaluating.</p>
<pre><code class="language-js">// foo.js
module.exports = { one: 1 };

// bar.js
import foo from &apos;./foo.js&apos;;
foo.one === 1; // true
</code></pre>
<p>Builtin modules will provide named exports of their public API, as well as a
default export which can be used for, among other things, modifying the named
exports. Named exports of builtin modules are updated when the corresponding
exports property is accessed, redefined, or deleted.</p>
<pre><code class="language-js">import EventEmitter from &apos;events&apos;;
const e = new EventEmitter();
</code></pre>
<pre><code class="language-js">import { readFile } from &apos;fs&apos;;
readFile(&apos;./foo.txt&apos;, (err, source) =&gt; {
  if (err) {
    console.error(err);
  } else {
    console.log(source);
  }
});
</code></pre>
<pre><code class="language-js">import fs, { readFileSync } from &apos;fs&apos;;

fs.readFileSync = () =&gt; Buffer.from(&apos;Hello, ESM&apos;);

fs.readFileSync === readFileSync;
</code></pre>
<h2>Loader hooks<span><a class="mark" href="_api_en_esm.html#esm_loader_hooks" id="esm_loader_hooks">#</a></span></h2><p class="link_cn_wrap"><a href="_api_esm.html#esm_loader_hooks" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<!-- type=misc -->
<p>To customize the default module resolution, loader hooks can optionally be
provided via a <code>--loader ./loader-name.mjs</code> argument to Node.js.</p>
<p>When hooks are used they only apply to ES module loading and not to any
CommonJS modules loaded.</p>
<h3>Resolve hook<span><a class="mark" href="_api_en_esm.html#esm_resolve_hook" id="esm_resolve_hook">#</a></span></h3><p class="link_cn_wrap"><a href="_api_esm.html#esm_resolve_hook" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<p>The resolve hook returns the resolved file URL and module format for a
given module specifier and parent file URL:</p>
<pre><code class="language-js">const baseURL = new URL(&apos;file://&apos;);
baseURL.pathname = `${process.cwd()}/`;

export async function resolve(specifier,
                              parentModuleURL = baseURL,
                              defaultResolver) {
  return {
    url: new URL(specifier, parentModuleURL).href,
    format: &apos;esm&apos;
  };
}
</code></pre>
<p>The <code>parentModuleURL</code> is provided as <code>undefined</code> when performing main Node.js
load itself.</p>
<p>The default Node.js ES module resolution function is provided as a third
argument to the resolver for easy compatibility workflows.</p>
<p>In addition to returning the resolved file URL value, the resolve hook also
returns a <code>format</code> property specifying the module format of the resolved
module. This can be one of the following:</p>

































<table><thead><tr><th><code>format</code></th><th>Description</th></tr></thead><tbody><tr><td><code>&apos;esm&apos;</code></td><td>Load a standard JavaScript module</td></tr><tr><td><code>&apos;cjs&apos;</code></td><td>Load a node-style CommonJS module</td></tr><tr><td><code>&apos;builtin&apos;</code></td><td>Load a node builtin CommonJS module</td></tr><tr><td><code>&apos;json&apos;</code></td><td>Load a JSON file</td></tr><tr><td><code>&apos;addon&apos;</code></td><td>Load a <a href="_api_en_addons.html">C++ Addon</a></td></tr><tr><td><code>&apos;dynamic&apos;</code></td><td>Use a <a href="_api_en_esm.html#esm_dynamic_instantiate_hook">dynamic instantiate hook</a></td></tr></tbody></table>
<p>For example, a dummy loader to load JavaScript restricted to browser resolution
rules with only JS file extension and Node.js builtin modules support could
be written:</p>
<pre><code class="language-js">import path from &apos;path&apos;;
import process from &apos;process&apos;;
import Module from &apos;module&apos;;

const builtins = Module.builtinModules;
const JS_EXTENSIONS = new Set([&apos;.js&apos;, &apos;.mjs&apos;]);

const baseURL = new URL(&apos;file://&apos;);
baseURL.pathname = `${process.cwd()}/`;

export function resolve(specifier, parentModuleURL = baseURL, defaultResolve) {
  if (builtins.includes(specifier)) {
    return {
      url: specifier,
      format: &apos;builtin&apos;
    };
  }
  if (/^\.{0,2}[/]/.test(specifier) !== true &amp;&amp; !specifier.startsWith(&apos;file:&apos;)) {
    // For node_modules support:
    // return defaultResolve(specifier, parentModuleURL);
    throw new Error(
      `imports must begin with &apos;/&apos;, &apos;./&apos;, or &apos;../&apos;; &apos;${specifier}&apos; does not`);
  }
  const resolved = new URL(specifier, parentModuleURL);
  const ext = path.extname(resolved.pathname);
  if (!JS_EXTENSIONS.has(ext)) {
    throw new Error(
      `Cannot load file with non-JavaScript file extension ${ext}.`);
  }
  return {
    url: resolved.href,
    format: &apos;esm&apos;
  };
}
</code></pre>
<p>With this loader, running:</p>
<pre><code class="language-console">NODE_OPTIONS=&apos;--experimental-modules --loader ./custom-loader.mjs&apos; node x.js
</code></pre>
<p>would load the module <code>x.js</code> as an ES module with relative resolution support
(with <code>node_modules</code> loading skipped in this example).</p>
<h3>Dynamic instantiate hook<span><a class="mark" href="_api_en_esm.html#esm_dynamic_instantiate_hook" id="esm_dynamic_instantiate_hook">#</a></span></h3><p class="link_cn_wrap"><a href="_api_esm.html#esm_dynamic_instantiate_hook" class="link_cn_text">&#x67E5;&#x770B;&#x4E2D;&#x6587;&#x7248;</a></p>
<p>To create a custom dynamic module that doesn&apos;t correspond to one of the
existing <code>format</code> interpretations, the <code>dynamicInstantiate</code> hook can be used.
This hook is called only for modules that return <code>format: &apos;dynamic&apos;</code> from
the <code>resolve</code> hook.</p>
<pre><code class="language-js">export async function dynamicInstantiate(url) {
  return {
    exports: [&apos;customExportName&apos;],
    execute: (exports) =&gt; {
      // get and set functions provided for pre-allocated export names
      exports.customExportName.set(&apos;value&apos;);
    }
  };
}
</code></pre>
<p>With the list of module exports provided upfront, the <code>execute</code> function will
then be called at the exact point of module evaluation order for that module
in the import tree.</p>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.write('<script src="api.js?1540915592519"><\/script>');
  </script>

<script src="../lib/backtop.js"></script></body></html>